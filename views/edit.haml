%link(rel="stylesheet" href="/stylesheets/codemirror/codemirror.css")
- %w{default elegant neat night solarized}.each do |theme|
  %link(rel="stylesheet" href="/stylesheets/codemirror/theme/#{theme}.css")

%script(type="text/javascript" src="/javascripts/codemirror/lib/codemirror.js")
- %w{clike haskell javascript lua perl php python ruby scheme smalltalk vb}.each do |mode|
  %script(type="text/javascript" src="/javascripts/codemirror/mode/#{mode}/#{mode}.js")

- %w{service codeEditor combobox languageSelect themeSelect compileButton dialogBase consoleDialog throttle}.each do |file|
  %script(type="text/javascript" src="/javascripts/#{file}.js")

%script(type="text/javascript" src="/javascripts/edit.js")

%body
  #header
    %h1 <a href="/"><span>Cloud</span>Develop</a>
    #link
      %p
        %a(href="/#{@collaboration.id}") Link to this session
    .clear
  
  #access-control
    .inner-access-control
      %ul.contributor-list
        %li.left-most Contributors:
        - @collaboration.contributors.each do |contributor|
          %li
            - if contributor == @contributor
              - if contributor == @collaboration.owner
                .current= "#{contributor} (you) (editing)"
              - else
                .current= "#{contributor} (you)"
            - elsif contributor == @collaboration.owner
              .owner= "#{contributor} (editing)"
            - else
              %a.contributor-link(href="javascript:void(0);")= contributor
        - if @contributor == @collaboration.owner
          %li.instruction (Click on a name to assign control.)
  
  #wrap
    - unless @alert.nil?
      #alert= @alert
    #content
      %form
        #toolbar-area
          %label(for="language-select") Language
          %select#language-select(name="language-select")
            - languages.each do |language|
              %option(value="#{language.key}")= "#{language.name}"
          %label(for="theme-select") Theme
          %select#theme-select(name="theme-select")
            %option(value="default" selected="selected") Default
            %option(value="elegant") Elegant
            %option(value="neat") Neat
            %option(value="night") Night
            %option(value="solarized") Solarized
        
        %textarea#code-editor(name="code-editor")= @collaboration.content
      
      #button-area
        %button#compile-button(name="compile-button") Compile
        
      .clear

  #console-dialog(title="Console")
    .loading-container
      .loading
        %img(src="/images/loading.gif")
        Compiling...
    .content-container
      .info
      %pre.output
  
  / This my horrible solution to getting values into JavaScript.
  / It is totally a hack. Probably could use rjs or something. To that I say:
  / Whatever.
  %input#pusher-api-key(type="hidden" value="#{ENV["PUSHER_API_KEY"]}")
  %input#current-owner(type="hidden" value="#{@collaboration.owner}")
  %input#current-language(type="hidden" value="#{@collaboration.language}")
  
  .footer
    %p
      CloudDevelop uses
      <a href="http://jquery.com/">jQuery</a>,
      <a href="http://codemirror.net/">CodeMirror</a>,
      <a href="http://http://pusher.com/">Pusher</a>, and
      <a href="http://ideone.com">ideone.com</a> &copy; by <a href="http://sphere-research.com">Sphere Research Labs</a>.
      Site developed by <a href="http://philosopherdeveloper.wordpress.com/">Daniel Tao</a>
      (<a href="https://github.com/dtao">dtao</a>).